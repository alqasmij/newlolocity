# Automatically generated on 2021-06-20 UTC from https://codemagic.io/app/60ccd3aaab5163754564833f/settings
# Note that this configuration is not an exact match to UI settings. Review and adjust as necessary.

  workflows:
    default-workflow:
    name: iOS Workflow
    # instance_type: mac_mini
    max_build_duration: 60
    environment:
      groups:
        APP_STORE_CONNECT_ISSUER_ID: bd9a4095-a52d-400f-ac40-27da4241deea
        APP_STORE_CONNECT_KEY_IDENTIFIER: 7DNXNP99C5
        APP_STORE_CONNECT_PRIVATE_KEY: Encrypted(Z0FBQUFBQmd6MHhJeWpqdkIxZUJqU3BJUzRyUFdiV1QyR2JoRE41MEd6Q1ZwbmR4VDFOSEJBb1RMaWZoOElqcXN1XzlFQ08zd3dnUTBHbzduOVZkY3JqVDNoalYxMDd0b054MXRFcjdqcGd1VEZ0aVF1NnZ6cGYtWF92bHNYYWdST2NDOHo3eTZaQkNOdG9IU28yYmpod1oyNmJsb0xWbnhyWTJ2TW15VnpSa2RlS2NoY2JyN3ltRV9IY2tZcjhiNGxhQm1DbDZxZWtwajFkQnRQSDl4N2xGblZUWnpCNkFEaHo5UFBLTVZRREg3VzgxVmRXekVsdEdKVVRFNFpiSEw4bl94aWJOb1g1MUxMaFI5Q1ZOM2YwOXhXZzFoMEMxanpGVGIzYW5vYjNKOWR1Y0phQmhHaDRhVlFGamt6TElkMGtHUjNkOC1VREUwSS11TjN5NFNaeFpJNjRIRmZRRmpsWC1UOER1Z1Vianp6b3dpMzFWazBjaks5RDVVYU1MUS1vVGpyZkJSRWttSndNRlROa2FmaGRxLWFNY3Y5T3UxZXNxaE55bndlb2JweGV2TTVXU2QxTT0=)
        CERTIFICATE_PRIVATE_KEY: Encrypted(Z0FBQUFBQmd6MHhJUXAzLTRfa0FyRVNBZ1R0LXZLOF9DSE1seWtoYzNnSU5zSmpXLU9QWjYwMWNBanFfUExxSkpmbUIzVXRGQVFfSDdodUVsMUMzNGpKZ05ySWxQNzhyNGlZZEMwZ0dXZUY2YzNkV0FpQlNWRkY2M2ZnWGswMlczMGN2V1dUMWJHd3AxbzlpMkF5WEtndXl5UEpNS3BjcGJBNmMxb2g5TXZKMVQxRFhBeHZIVDJjbmk3S19TRDZLNU9ITHJqbl9nX3VfNHlwZXg1R0k3X3lnUEgzcy1nSktfZmxRdzhOUVN5QkxYSWd5d0hyd2VrSmVyekM3UEJCX2JZWWp5ZWJWanNPcDRSSG13dE9nbUJweEdOeHBoVEtrU1RycmZtSHdGLVJSV2Z6UERYT2lxMWNURE1ub2VjSjhJaXZGNmd5Z1Nlbjc1TmZxSVg2UVVoUDVVZjhpZVQ5dXNTaF9iN1RwUmNxSXBxalNaWW9fUklVTmRRa1gyTkY2aTFQcGQyaEFCMVFXZ3I0aHBpdk94UHBicGJZZjl6VE1yems3bUhGNjl6OHZMeTQ1X2NGYXJubWh2UHl2TVc3ajNZRGxmdHZGbWhHamRiS2tOMmZEaUsyVjJxM2FuaHdLZmg4bGprSWNKeTdnNHpWZmtZMldUWnNfbGVFSjVLTkhpaDktakJ5Q1k4Mkc2c0kxa3RWSEstSFhQeHhRMTBQN1pXZTFRWFJlRmJVa0xPYXN0T0hla3E4YWw1bGlCclJuRDZuTzhwcTM0SDluMkpiVGd0RjBwdGtmdlFXUzlPNWllZG51b2Z3dTMtOXo4NzdwN1hPLVRvcnpEVUlvSUJyVk91WGs1SXE1enFuVjN1WE16YkdOdG1pLVYtSXVjQThSQTlrQW5oOVE1RG5CNmc4Tk56WEw3ODZZMGJqd0xRckgzZnJOMFRHV0ZFN04zd1hUdTFuZzZTY2FrcnRYUTIxRDVkaHdoTDNLc0Q5VW1Vc0EtRjlKTFVvM0lKcV91X1dNTnFLN0NiaV9VZnNYeThYaE5nVnB5aXhURlRvZXROOHB6eGkyS3R0TXI0SXF4TzhLME1CSTlleVdWODl6aE9mVF9fdzIyU0xXZ1hMclJmLUFTNkhDSGkxVTdyRklFX3RCMjlHZmVkemtqeFVUYXhUWEtsMG1wQmpKTVpkY1hEWWxuSlRTeDJORGpucFl0RDA2R3ZVVWxRR0pTMDZqVE1uWmtsZ2g2TGNaNkdYakNJVkgyak94VzV1NUlLMDU1djgyMU1QVmJ5WTVFU2JnQ2VLNE12U1hMZ1hra1pRa2g1S212bmo2cTNvUGxxdXRXSGhpb3ZDY3dFekcwQURyNE9Bc1VFeGd4Y1RFanBmWjZacWsteWNyUkdJY0NnRWRkZFQ1dzB3OER4aW9UUnhSaElqQlJxOG5LUTBoNG1PSzlVc1JHV1E5WUpNNnM5S3FxVVFuOUdlNlR4aU1lTWlQclhBS0tMSHVqTnN5TWhHdU9xRXZGY2NWY2dmTkRJdklaUHBjaU9jTU5UT3JYR3lNTVE2VS1IWHNJLXlnWEJxNURVLVJsQXpXV3hNVnVIME44LXo2TEtkWEZSSlNqdktsendqbTJqQlFqSzJtS2t6MC16Q3Z6WUhDNHl4cHYtTWNOaXpXWFhGbGhDZVBkWS0xbGdnV3BQN3BJYXEtTk9LdlV2cEVKRHhwTmtMUHZ2UzVqQThUSkh0OFFLZkRNNnF3WFFLdVlyanNORXpBQk05b1g1TUcyLS1Ld2RkYlMzMVdMcTNxeldEbGJ1UUVHcmRPVHhoZlFrME5LNk5mUjFFMWdLQ29WczZVejI0c3FhcGxZMnlmRk95VVJ3cnNEZzRXVEdlVFI3aG45NmJrcTR2VjlUOGp1TFBrX1g4T2NvbHFCUFlOazMwaU5qbnNSb3BKNktYWFJ5VVFpcU1ON2dtcGpDS3dOZ3hNVmhiT3hwZlliNVAwSmp4TlhoM1NUbG1MM1pVVDdfQm4xUTBxYmlXZC1tZUNJTTJSUmtqdWdMd192RlRTbF9JM3BCTzBoYWpZc2dTMFJERzlZck12aEViSGxjcTR3RWREdTVvTU50VHJDV2VrdFpRdGlINGw4SXI3aUtFOU13MlMwV0dzY2NIb181NHZLeFR2S00wWkNrSml0S0FUV3QteXpia083UnJ2d1p1aEp0UTVFdVlYZkRRcEVhWHpoR1R4WTBWLTUwajN6NFVoS2tGMmhpMTdVZVVhdjZMUHJmY2QzdUFiM3E0UXp3REFhVzNTYVFYZWN2QjJaRmd0Y19ZM2pWX1RaTnNWZHdaRnpqMk5aQ1Z4UC1BbjM2ZHVvckU5MnhPbWs3aXhnSWtPY0s2V0d4S01RUHFRQmhRN21HTnd2NV9KbmNwVkl6UG1rcndDM2dibFhmZTJPY2F3VTFhd3JTMVRmdXV4Z2dhOG5pb3g4T21aZ2otNVpOenYzb0tudUplUlBnTV92M0pNSHpSUmNGQTBpRktiZnJtWHlJQ3pPN25sU3Fncm1KbnVlUXhiXzdfblRvckJxT2xoRTMyd2tPeXN4XzBubHJTRG5VMk9hSURGdVNLdHd4M083cXZLQzBJaXNoMUk5b011QWQ1b2V2OVduZFFET19PVG1FakFFcmlKVzlHdWJ1WVhDLUt6WDEwZ1JSZGZtQmxvSXQtYkdYYVRrSmVGOXR1MlJsRkN6YmtNSnprakZxb0ZlV2RQMWVocXRYQ0o5QktOY28wSVNFYmtzRXVFNUpVaTF0b3BvSGhOMXZZbmpYRHBRazlyWHhjQXBRWE1uTF92NXRGZy1fRDhVVUw2ai1DZWZPMzRIc0lIN0V6dkxsNXFSSlBGei00SzFORWRwM05RYUFUWHpFSzJaVnYyVVlQUy1rWmpPSll5X0ktNUlNTkUtUzYyd0pXYm02MGZXZFNuY0lPNEsyTXNrdUIwMzhndVZzcVBtYUpnbW9WMjJMclFIMU5NczI1WDlQUGE0SV9yUVR5aUUybFJJaXhrbGdtdURWMGxoSnNDLWhGX0xiWHpKOHM1QWE0cnIxcFFTRG9RZlROWDVjZXk2VVRQ)
      vars:
        XCODE_WORKSPACE: "Runner.xcworkspace"
        XCODE_SCHEME: "Runner"                
        BUNDLE_ID: "com.citylolo.app.citylolo"
        APP_STORE_ID: 1588617990 # <-- Use the TestFlight Apple id number (An automatically generated ID assigned to your app) found under General > App Information > Apple ID. 
      flutter: stable
      xcode: latest
      cocoapods: default
    scripts:
      - name: Set up keychain to be used for codesigning using Codemagic CLI 'keychain' command
        script: |
          keychain initialize
      - name: Fetch signing files
        script: |
          app-store-connect fetch-signing-files $BUNDLE_ID --type IOS_APP_STORE --create
      - name: Use system default keychain
        script: |
          keychain add-certificates
      - name: Set up code signing settings on Xcode project
        script: |
          xcode-project use-profiles
      - name: Get Flutter packages
        script: |
          cd . && flutter packages pub get
      - name: Flutter analyze
        script: |
          cd . && flutter analyze
      - name: Flutter unit tests
        script: |
          cd . && flutter test
        ignore_failure: true          
      - name: Install pods
        script: |
          find . -name "Podfile" -execdir pod install \;
      - name: Flutter build ipa and automatic versioning
        script: |
          flutter build ipa --release \
          --build-name=1.0.0 \
          --build-number=$(($(app-store-connect get-latest-testflight-build-number "$APP_STORE_ID") + 1)) \
          --export-options-plist=/Users/builder/export_options.plist
    artifacts:
      - build/ios/ipa/*.ipa
      - /tmp/xcodebuild_logs/*.log
      - flutter_drive.log
    publishing:
      # See the following link for details about email publishing - https://docs.codemagic.io/publishing-yaml/distribution/#email
      email:
        recipients:
          - alqasmij@gmail.com
        notify:
          success: true     # To receive a notification when a build succeeds
          failure: false    # To not receive a notification when a build fails
      app_store_connect:   # https://docs.codemagic.io/publishing-yaml/distribution              
        api_key: $APP_STORE_CONNECT_PRIVATE_KEY         # Contents of the API key, can also reference environment variable such as $APP_STORE_CONNECT_PRIVATE_KEY
        key_id: $APP_STORE_CONNECT_KEY_IDENTIFIER       # Alphanumeric value that identifies the API key, can also reference environment variable such as $APP_STORE_CONNECT_KEY_IDENTIFIER
        issuer_id: $APP_STORE_CONNECT_ISSUER_ID         # Alphanumeric value that identifies who created the API key, can also reference environment variable such as $APP_STORE_CONNECT_ISSUER_ID
        submit_to_testflight: true                     # Optional boolean, defaults to false. Whether or not to submit the uploaded build to TestFlight beta review. Required for distributing to beta groups. Note: This action is performed during post-processing.
